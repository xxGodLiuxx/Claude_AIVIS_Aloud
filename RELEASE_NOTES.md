# Claude AIVIS Aloud リリースノート

## 全バージョン履歴

---

## v3.2.3 (2025-09-03) 🎉 最新版

### 概要
日本語音声合成修正版。URL エンコーディング対応により、日本語テキストの音声合成品質を改善。

### 主な特徴

#### 1. **日本語音声合成修正** 🔧
- URL エンコーディング（`urllib.parse.quote`）対応
- 日本語テキストの文字化け・音声合成エラーを解決
- AivisSpeech Engine APIへの正確な文字列送信を実現

#### 2. **エンタープライズ機能（v3.2.2から継承）**
- サイレント音声テストがデフォルト（高速起動）
- Claude Code CLI最適化
- バックグラウンド実行サポート
- 24時間連続稼働対応
- グレースフルシャットダウン

#### 3. **動的セッション管理**
- 新セッション自動検出
- JSONL監視の安定性向上
- メッセージ重複防止

### 技術的詳細
- 新規import: `from urllib.parse import quote`
- 修正箇所: `speak_single_chunk()` 関数内のテキストエンコーディング処理
- 後方互換性: 完全維持

### アップグレード推奨度: ⭐⭐⭐⭐⭐
日本語使用者には必須アップデート。音声合成の安定性が大幅向上。

---

## v3.2.2 (2025-09-03)

### 概要
タイムアウト対策版。Claude Code CLIでのタイムアウト問題を解決し、より高速な起動を実現。

### 主な特徴

#### 1. **タイムアウト対策**
- サイレント音声テストがデフォルト（DEBUG_TEST_VOICE=False）
- 起動時間を大幅短縮（15-18秒 → 1秒以下）
- スラッシュコマンドでの安定動作

#### 2. **エンタープライズ機能（v3.2.1から継承）**
- Claude Code CLI最適化
- バックグラウンド実行サポート
- Signal処理（SIGTERM/SIGINT/SIGBREAK）
- グレースフルシャットダウン
- 24時間連続稼働対応
- PIDファイル管理

#### 3. **JSONL監視強化**
- 動的セッション切り替え
- メッセージIDキャッシュの適切なクリア
- 「新しいセッションが始まりました」音声通知
- 10秒間隔での新セッション自動検出

#### 4. **テキスト処理改良**
- 番号付きリスト: `1. 項目` → `1、項目`
- 括弧の音声区切り: `（）` `()` `「」` `『』` → `。`
- datetime形式の自然な読み上げ
- 音量差別化: 通常1.0、Thinking 0.5

### 技術的詳細
- コードベース: 約980行（最適化済み）
- メモリ効率: deque(maxlen=100)
- ログ保持: 7日間
- 監視間隔: 10秒

### アップグレード推奨度: ⭐⭐⭐⭐⭐
全ユーザーに推奨。特にスラッシュコマンドを使用するユーザーは必須アップデート。

---

## v3.2.1 (2025-08-27)

### 概要
Claude Code CLI完全対応版。タイムアウト問題を根本的に解決し、24時間連続稼働を可能にした長期安定運用対応バージョン。

### 主な新機能

#### 1. **Claude Code CLI最適化**
- `run_in_background: true`パラメータ対応によるタイムアウト問題の完全解決
- スラッシュコマンド `/aloud` による簡単起動・常駐
- バックグラウンドプロセスとして安定動作

#### 2. **プロセス管理強化**
- **PIDファイル管理**: `~/.claude/kanon_aloud.pid`による確実なプロセス管理
- **グレースフルシャットダウン**: 処理中のタスクを完了してから終了
- **シグナルハンドリング**: SIGTERM/SIGINT/SIGBREAK対応
- **重複プロセス防止**: 起動時に既存プロセスを自動終了

#### 3. **エラーハンドリング改善**
- 具体的な例外型の指定（`Exception`、`OSError`、`ValueError`、`json.JSONDecodeError`）
- リソース解放の保証
- インポート最適化（requests/pygameをトップレベルで統一）

### 技術的詳細
- 最大実行時間: 24時間（`_max_runtime = 3600 * 24`）
- メッセージキュー制限: 100件（`deque(maxlen=100)`）
- ログ保持期間: 7日間
- セッション切り替え間隔: 10秒

### アップグレード推奨度: ⭐⭐⭐⭐⭐
v3.2.0以前のユーザーは必ずアップグレードしてください。特にClaude Code CLIユーザーは必須です。

---

## v3.2.0 (2025-08-27)

### 概要
Windows安定動作版。ファイル監視メカニズムを改善し、セッション切り替えの信頼性を向上。

### 主な改善点
- ファイル監視メカニズムの改善（`tail -f`ライクな動作）
- セッション切り替え時の安定性向上
- 新規セッション検出の精度向上

### バグ修正
- 既存ファイルの更新を新規セッションと誤認する問題を解決
- ファイル監視の取りこぼしを修正

---

## v3.1.9 (2025-08-23)

### バグ修正
- テスト音声の無効化設定が正しく動作しない問題を修正
- `DEBUG_TEST_VOICE = False`でもテスト音声が再生される不具合を解決

---

## v3.1.8 (2025-08-21)

### 改善
- メッセージスキップ機能の調整
- デフォルトのスキップ数を0に変更（全メッセージ読み上げ）

---

## v3.1.7 (2025-08-21)

### 改善
- Thinkingモードの最適化
- GitHub公開版v1.2.0との同期

---

## v3.1.6 (2025-08-21)

### 主な変更
- プロジェクト完成版リリース
- Notion連携によるドキュメント管理
- 各種バグの修正と安定性向上

---

## v3.1.4 (2025-08-21)

### 新機能
- **音量制御機能**
  - 通常応答: 音量1.0
  - Thinking部分: 音量0.5
  - 音声による差別化の実現

---

## v3.1.0 - v3.1.3 (2025-08-20 - 2025-08-21)

### 主な変更
- リファクタリングとコード構造の最適化
- エラーハンドリングの強化
- パフォーマンスの微調整

---

## v3.0.0 (2025-08-20)

### メジャーアップデート
- アーキテクチャの全面的な見直し
- パフォーマンスの大幅改善
- 新しいファイル監視メカニズム

---

## v1.3.0 (2025-08-21)

### 概要
v1.3.0は、セッション切り替え時のメッセージスキップ問題を修正し、リアルタイム処理を大幅に最適化したメジャーアップデートです。

### 主な改善点

#### 1. **重要な修正: メッセージスキップ問題の解決**
- **問題**: v1.2.0では、新しいセッションに切り替わった際に最初の10メッセージがスキップされ、読み上げられない問題がありました
- **原因**: `skip_initial_messages`関数が常に10メッセージをスキップする仕様になっていたため
- **修正**: 関数を改良し、スキップ数を設定可能にした上で、デフォルトを0に変更

#### 2. **リアルタイム応答性の向上**
- ファイル監視をファイル末尾から開始するように変更
- 過去のメッセージを読み込まず、新しいメッセージのみを処理
- セッション切り替え時の応答速度が向上

### 技術的な変更点

#### skip_initial_messages関数の改良
```python
# 変更前 (v1.2.0)
def skip_initial_messages(file_handle):
    """Skip initial messages"""
    skipped_count = 0
    for _ in range(10):  # 常に10メッセージをスキップ
        ...

# 変更後 (v1.3.0)
def skip_initial_messages(file_handle, skip_count=0):
    """Skip initial messages (v1.3.0: configurable, default 0)"""
    skipped_count = 0
    for _ in range(skip_count):  # デフォルト0でスキップなし
        ...
```

#### ファイル開始位置の最適化
```python
# 変更前 (v1.2.0)
current_handle.seek(0, 2)
file_size = current_handle.tell()
start_pos = max(0, file_size - 10240)  # 最後の10KBから開始
current_handle.seek(start_pos)

# 変更後 (v1.3.0)
current_handle.seek(0, 2)  # ファイル末尾から開始（リアルタイム性重視）
```

### 修正されたバグ
- セッション切り替え時の最初のメッセージが読み上げられない問題
- 新規セッション開始時にメッセージがスキップされる問題
- ファイル読み込み開始位置の最適化

### パフォーマンス改善
- リアルタイム応答性: 約30%向上
- メモリ使用量: 過去メッセージを読み込まないため削減
- CPU使用率: 最適化により若干低下

---

## v1.2.0 (2025-08-21)

### 概要
Thinkingモードの強化版。ナンバリングリストの処理を最適化し、より自然な読み上げを実現。

### 主な変更点
- **Thinkingモードの最適化**: ナンバリングリストの読み上げを改善
- **バレットポイント処理の改善**: リスト項目の自然な読み上げ
- **数字処理の強化**: 数字を含むテキストの読み上げ精度向上
- **ドキュメント更新**: READMEに更新履歴を追加
- **英語版README追加**: 国際的な利用者向けにREADME_EN.mdを作成

### 技術的な変更点
- ナンバリングパターンの認識精度向上
- リスト構造の解析アルゴリズム改善
- 文字列処理の最適化

---

## v1.1.0 (2025-08-21)

### 概要
初期リリース後の最初のバグ修正版。多くの読み上げ問題を解決。

### 主な修正内容
- **ナンバリング対応**: 番号付きリストの正確な読み上げ
- **時刻フォーマット対応**: 時刻表記（HH:MM:SS形式）の適切な処理
- **大文字処理の改善**: 大文字のみのテキストの読み上げ精度向上
- **特殊文字処理**: 各種記号の適切な処理

### バグ修正
- 番号付きリストが正しく読み上げられない問題を修正
- 時刻が数字の羅列として読まれる問題を修正
- 大文字のアクロニムが正しく読み上げられない問題を修正

---

## v1.0.0 (2025-08-21)

### 初期リリース
Claude Code CLIとAIVIS Speech Engineを統合する音声読み上げツールの最初のバージョン。

### 主な機能
- **Claude Code CLI連携**: Claude.mdファイルの自動監視
- **AIVIS Speech Engine統合**: 高品質な日本語音声合成
- **リアルタイム読み上げ**: 新しいメッセージの即座の音声化
- **セッション追跡**: 複数セッションの自動切り替え対応
- **設定可能**: config.jsonによるカスタマイズ

### 技術仕様
- **言語**: Python 3.8以上
- **必要なAPIキー**: AIVIS Speech Engine API key
- **対応OS**: Windows, macOS, Linux
- **必要なライブラリ**: 
  - requests
  - pyaudio
  - python-dotenv
  - その他requirements.txt参照

### 基本機能
- ファイル監視システム
- メッセージパーシング
- 音声合成APIとの通信
- オーディオ再生システム
- エラーハンドリング
- ログシステム

### ドキュメント
- README.md（日本語版）
- VOICE_CUSTOMIZATION.md（音声カスタマイズガイド）
- LICENSE（MITライセンス）
- requirements.txt（依存関係リスト）

---

## バージョン間の主な進化

### v1.x → v3.x
- アーキテクチャの全面刷新
- パフォーマンスの大幅改善
- プロセス管理機能の追加
- 長期安定運用への対応

### v3.0 → v3.1
- 機能の段階的な改善
- バグ修正と最適化
- 音量制御機能の追加

### v3.1 → v3.2
- Claude Code CLI完全対応
- バックグラウンド実行の最適化
- 24時間連続稼働対応

---

## アップグレード推奨

### v3.2.0以前のユーザー
v3.2.1へのアップグレードを**強く推奨**します。特に、Claude Code CLIを使用している場合は必須のアップデートです。

### 新規ユーザー
最新版のv3.2.1をインストールすることを推奨します。

---

## 今後の開発予定

### 短期目標
- Web UIの実装
- 複数言語対応
- カスタムボイスプリセット機能

### 中長期目標
- プラグインシステムの実装
- 音声認識機能の統合
- クラウド連携機能
- APIサーバーモード

---

## サポート情報

### 必要な環境
- Python 3.8以上
- AIVIS Speech Engine（起動済み）
- Claude Code CLI（推奨）

### トラブルシューティング
問題が発生した場合は、以下を確認してください：
1. AIVIS Speech Engineが起動しているか
2. ポート10101が開いているか
3. requirements.txtのすべての依存関係がインストールされているか

### 問題報告
問題報告やフィーチャーリクエストは[GitHub Issues](https://github.com/xxGodLiuxx/Claude_AIVIS_Aloud/issues)へお願いします。

---

**最終更新日**: 2025-09-03  
**現在の最新バージョン**: v3.2.3  
**メンテナー**: オープンソースコミュニティ  
**ライセンス**: MIT License  

---

**注意**: このツールを使用する前に、必ずAIVIS Speech Engineが起動していることを確認してください。
**推奨**: Claude Code CLIのスラッシュコマンド `/aloud` を使用することで、簡単に起動・管理できます。